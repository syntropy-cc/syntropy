# Dockerfile.dev
FROM node:20-alpine

WORKDIR /app

# Enable Corepack for proper package manager support
RUN corepack enable

# Copy package manager files
COPY package*.json yarn.lock* pnpm-lock.yaml* ./

# Install dependencies using the correct package manager
RUN if [ -f pnpm-lock.yaml ]; then \
        pnpm install; \
    elif [ -f yarn.lock ]; then \
        yarn install; \
    elif [ -f package-lock.json ]; then \
        npm ci; \
    else \
        npm install; \
    fi

# Copy source code (ser√° sobrescrito pelo volume mount)
COPY . .

# Expose port
EXPOSE 3000

# Determine the correct dev command based on package manager
CMD if [ -f pnpm-lock.yaml ]; then \
        pnpm dev; \
    elif [ -f yarn.lock ]; then \
        yarn dev; \
    else \
        npm run dev; \
    fi